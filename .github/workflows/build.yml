name: Build and Release StaticGo (Windows)

on:
  push:
    tags:
      - 'v*'  # ä»…å½“ Push ä»¥ v å¼€å¤´çš„ Tagï¼ˆå¦‚ v1.0.0ï¼‰æ—¶è§¦å‘

jobs:
  build-and-release:
    name: Build & Release for Windows
    runs-on: windows-latest

    steps:
      # 1. æ‹‰å–ä»£ç ï¼ˆç¡®ä¿è·å–åˆ° Tag ä¿¡æ¯ï¼‰
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # è·å–å®Œæ•´ Git å†å²ï¼ŒåŒ…æ‹¬ Tag

      # 2. è®¾ç½® Node.js ç¯å¢ƒ
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20  # å’Œä½ é¡¹ç›®ä¸€è‡´

      # 3. å®‰è£…ä¾èµ–
      - name: Install dependencies
        run: npm install

      # 4. æ„å»º Windows å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆå’Œç°æœ‰æµç¨‹ä¸€è‡´ï¼‰
      - name: Build the app (generate .exe)
        run: npm run dist

      # 5. æ£€æŸ¥ç”Ÿæˆçš„äº§ç‰©ï¼ˆå¯é€‰ï¼Œè°ƒè¯•ç”¨ï¼‰
      - name: List build artifacts
        run: dir ./go  # æˆ– ls ./goï¼ˆLinux/macOSï¼‰

      # 6. è‡ªåŠ¨åˆ›å»º GitHub Release å¹¶ä¸Šä¼  .exe
      - name: Create Release & Upload .exe
        uses: softprops/action-gh-release@v1
        with:
          # è‡ªåŠ¨ç”Ÿæˆ Release æ ‡é¢˜ï¼ˆå¦‚ v1.0.0ï¼‰
          tag_name: ${{ github.ref }}  
          # è‡ªåŠ¨ç”Ÿæˆ Release åç§°ï¼ˆå’Œæ ‡é¢˜ä¸€è‡´ï¼‰
          name: ${{ github.ref_name }}    
          # è‡ªåŠ¨ä» Git Tag çš„ message ä¸­æå–å‘å¸ƒæ—¥å¿—ï¼ˆå¦‚æœæ²¡æœ‰åˆ™ç”¨é»˜è®¤æ–‡æ¡ˆï¼‰
          body: |
            ğŸ“¦ è‡ªåŠ¨å‘å¸ƒç‰ˆæœ¬ï¼š${{ github.ref_name }}

            æ­¤ç‰ˆæœ¬åŒ…å«æœ€æ–°çš„ Windows å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¯·ä¸‹è½½ä½¿ç”¨ã€‚
            
            æ„å»ºæ—¶é—´ï¼š${{ github.run_number }}
          # ä¸Šä¼  ./go ä¸‹çš„ .exe æ–‡ä»¶
          files: |
            ./go/*.exe
          # è®¾ç½®ä¸ºâ€œæœ€æ–°ç‰ˆæœ¬â€ï¼ˆæ–¹ä¾¿ç”¨æˆ·ç›´æ¥è·å–æœ€æ–°ç‰ˆï¼‰
          draft: false
          prerelease: false
